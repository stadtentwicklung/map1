Update available here [https://stadtentwicklung.github.io/masterplan/]

Some new information are in the linked repository [https://github.com/stadtentwicklung/masterplan]   

# :world_map: Masterplan Cottbuser Ostsee
:white_check_mark: Georeferenziertes Rendering erstellen und als Web-Map publizieren mit Standortermittlung.

## :computer: Link [https://stadtentwicklung.github.io/map1/)

### :camera_flash: WebMapApp-Screenshot:
![Screenshot der GitHub-Pages App](https://raw.githubusercontent.com/stadtentwicklung/map1/master/img/screenshot.JPG) 

## :rocket: Entstehungsprozess:

### :compass: Ausgangslage:
Der 1. [Masterplan Cottbuser Ostsee](https://www.cottbus.de/verwaltung/strukturentwicklung/ostsee/) (MaplOS) wurde vor ca. 15 Jahren mit AutoCAD erstellt. Das Projekt hat während dieser Zeit über 250 Layer angesammelt. Das dargestellte Gebiet des 3. Updates des MaplOS (MaplOS3) ist von 100 km&sup2; auf 180 km&sup2; gewachsen. Das Layout des Masterplans wurde auf ein DIN A1 Format gesetzt, womit die Darstellung den Maßstab 1:20.000 erhält. Diese beiden wichtigen Parameter orientieren sich an der Historie des Projektes. (1) Eine verbesserte Lesbarkeit trotz Vergrößerung der Gesamtfläche, (2) die dargestellten Elemente müssen verifizierbar sein, (3) die Anzahl der Datei-Layer auf ein überschaubares Maß reduzieren und (4) eine plastischere Visualisierung sind u.a. Anforderungen an den Relaunch. Technisches Ziel ist die Erhöhung der informativen und illustrativen Qualität des Plans. Der Plan muss als Ausdruck, aber auch auf Displays überzeugen. Auf Displays kann der Ausschnitt eines Dokument vergrößert werden. Zu einer einheitlichen Gesamtwirkung kommt das Kriterium Detailaussagen hinzu.

### :computer: Starter-Software:
Der MaplOS3 wurde wieder in AutoCAD Map 3D (ACM) technisch konstruktiv weiterentwickelt. ACM eignet sich sehr gut für eine Entwurfsgestaltung zwischen CAD und GIS mit großen Datenmengen. Der MaplOS3 enthält ca. 50.000 Einzelelemente. Werden die abgebildeten Gebäude dazugerechnet, verdoppelt sich die Anzahl auf über 100.000 (QGIS errechnet beim Einlesen einer .dwg oder .dxf die Anzahl der importierten Elemente). ACM bleibt dabei überwiegend performant und robust. Das Verschieben oder die individuelle Anpassung von Vektoren geht schneller als z.B. in QGIS. Die Arbeit mit georeferenzierten Inhalten läuft im Gegensatz z.B. zu Vectorworks ohne mehrere Nullpunkte. Außerdem lesen viele Programme .dwg- oder .dxf-Dateien problemlos ein.

### :floppy_disk: Datengrundlage:
Die vorhandenen Inhalte des MaplOS2 sind abgeglichen mit den kostenfreien Daten aus dem aktuellen ATKIS und ALKIS des Amtes [Landesvermessung und Geobasisinformation Brandenburg](https://geobasis-bb.de/lgb/de/) (LGB). Damit stehen großflächige, georeferenzierte und einheitliche amtliche Vektordaten zur Verfügung für die insgesamt sechs zumindest teilweise darzustellenden Verwaltungsgebiete. Mit QGIS werden die Objekte und deren Daten komfortabel vorab gesichtet, ggf. bearbeitet und als .dxf exportiert. In ACM werden diese georeferenzierten Zeichnungselemente ohne ihre ursprünglichen Attributdaten individuell angepasst. Vorhandene aktuelle Wasserwege, Straßenverläufe und Flächennutzungen sind so mit den Planungen sachlich korrekt abgeglichen, aber auch Lücken im Datenbestand können geschlossen werden. Die als See dargestellte ehemalige Tagebaugrube erhält eine Tiefenvisualisierung. Die LGB stellt Isolinien im Shape-Format als DGM bereit, die QGIS entsprechend den Höhenattributen mit einem blauen Farbverlauf visualisiert. QGIS speichert das Ergebnis als .dxf und ACM öffnet diese verlustfrei.

### :memo: Inhaltsstruktur:
Der Plan beinhaltet Flächengeometrien (Polygone), Liniengeometrien, Symbole (Gruppe von Geometrien), Punktgeometrien (Höhenpunkte) und Beschriftungen. Alle Teile der Legende, bis auf die Symbole, sind in Adobe Illustrator (Ai) gebaut. ACM lädt die externe Datei einfach als Referenz. Für einen grafischen statt technischen Ansatz liefert Ai schneller Ergebnisse. Die Icons im unteren Bereich der Legende sind in ACM neu konstruiert. In verschiedenen Größen wurden Mustericons auf Papier ausgedruckt, wobei deren, für die Lesbarkeit notwendige Mindestgröße i.V. mit dem Maßstab, festgestellt wurde. Ebenso ist die Darstellung der globalen Breiten von Straßenlinien ermittelt. Auf die Nutzung von Liniensymboliken aus der Bibliothek in ACM wurde verzichtet, um die einheitliche Darstellung auch nach dem Export abzusichern.

### :art: Color-Management:
Die Farben für die Flächennutzungen sind von über 20 auf 10 Farben reduziert. Eine Flächennutzung wird immer in den Kategorien Bestand und Planung dargestellt. Um die Gesamtwirkung des MaplOS3 zu vereinheitlichen, wurden einerseits Nutzungsarten passend zusammengefasst. Es war sinnvoll, eine Kategorie lediglich mit einer dezenten diagonalen Schraffur darzustellen, statt mit einer zusätzlichen Farbe. Somit ist die Trennung in hell und dunkel gegeben. Die Flächen sind jetzt für das Auge optisch einfach zu unterscheiden, was den Plan lesbarer und verständlicher macht. Die großflächig eingesetzten Primärfarben sind gering gesättigt und leuchten daher nicht, was natürlicher wirkt. Die Farbwahl orientiert sich an der Baunutzungsverordnung. Die Color-Feinabstimmung erfolgte mit Hilfe einer Farbtafel in der Farbbibliothek von Ai.

### :cinema: Rendering:
Um dem visuellen Anspruch eines Masterplans gerecht zu werden bei gleichzeitig amtlich korrekt dargestellten Inhalten musste eine Form des Renderings für Schattierungseffekte genutzt werden. Ein zeitlich überschaubares und dennoch überzeugendes Rendering mit 50.000 Low-Poly-LOD1-Gebäuden auf einer Fläche von fast 200 km&sup2; mit insgesamt 100.000 Einzelelementen konnte nicht aus einer echten 3D-Szene generiert werden, da die notwendige Rechenleistung die vorhandenen technischen Kapazitäten überschreitet. Die Plastizität des Endergebnisses wurde daher mit den 3D-Funktionen in Adobe Photoshops (Ps) realisiert. Die ACM-Datei wurde jeweils mit verschiedenen Ebenen exportiert. Die Ebene mit den farbigen Flächennutzungsgeometrien wurde zuerst in Ps geöffnet und zur 3D-Ebene geändert. Ps benutzt u.a. sog. Normalmaps (Schummerungen) für Höhen- und Tiefeninformationen, womit die Flächen an entsprechenden Stellen nach oben oder unten "gedrückt" werden. Sichtbar wird der Effekt nach Aktivierung einer gerichteten Lichtquelle. Der Verlauf dieser künstlichen "Sonne" und die sich dadurch verändernden Schattierungen werden so direkt sichtbar. Der MaplOS3 wurde zweimal auf diese Art gerendert. Für das erste Rendering wurde ein amtliches [Bildbasiertes Digitales Oberflächenmodell](https://geobroker.geobasis-bb.de/gbss.php?MODE=GetProductInformation&PRODUCTID=03de0e12-fb9f-47ae-b564-851365e2ae66) (bDOM) benutzt. Das zweite Rendering wurde mit einer individuell erstellten Normalmap erzeugt. Danach wurden die anderen Ebenen importiert und über die Ebenen-Fülloptionen gestalterisch mit Schlagschatten oder weißer Kontur für die Beschriftung abgerundet.

### :iphone: Webpublikation:
Der Urspungsplan aus ACM enthält in den Ecken Koordinatenangaben im lokal üblichen EPSG:25833. Der Plan wurde in QGIS mit Hilfe der Koordinatenangaben (in den Ecken des Plans) nach EPSG:3857 georeferenziert. Für die Verwendung von Leaflet.js ist das zwingend glaube ich. Das entstandene georeferenzierte Bild wurde in QGIS als Projekt geöffnet und über die Funktion [gdal2tiles](https://wiki.openstreetmap.org/wiki/GDAL2Tiles) in ca. 500 Kacheln inklusive fertigem Leaflet.html-Template ausgegeben. Für die Web-Map steht nun statt einer Vektorkarte ein plastischer wirkendes Rendering zur Verfügung. Der Code der Datei wurde angepasst. Alle voreingestellten Tiles sind entnommen, was die Performance erhöht. Hinzugefügt sind Custom-Marker mit Popups und JavaScript für die Anzeige einer Ladegrafik sowie die Standortermittlung. Über die Kommandozeile ist das Projekt in ein GitHub Repository migriert. Die Funktion GitHub Pages hostet die Map als Web-App. Wer vor Ort ist und auf einem Handy Internetzugang hat, kann sich live auf dem Plan informieren und navigieren.

### :camera_flash: WebMapNotes:
![Kopie der Notizen zur Vorbereitung der Webapplikation](https://raw.githubusercontent.com/stadtentwicklung/maplos/master/img/notes.png) 

### :coffee::coffee::coffee: by [Stefan](https://github.com/stefanstoehr)
